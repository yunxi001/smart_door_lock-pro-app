# v2.5åè®®é€‚é… - é›†æˆæ£€æŸ¥æ¸…å•

## ä»»åŠ¡21: æ£€æŸ¥ç‚¹ - é›†æˆå®Œæˆ

### 1. ç»„ä»¶é›†æˆæ£€æŸ¥ âœ…

#### 1.1 App.tsxçŠ¶æ€ç®¡ç†

- [x] visitorIntentsçŠ¶æ€å·²æ·»åŠ ï¼ˆç¬¬127è¡Œï¼‰
- [x] packageAlertsçŠ¶æ€å·²æ·»åŠ ï¼ˆç¬¬130è¡Œï¼‰
- [x] toastQueueçŠ¶æ€å·²æ·»åŠ ï¼ˆç¬¬133-138è¡Œï¼‰
- [x] currentSubScreençŠ¶æ€å·²æ·»åŠ ï¼ˆç¬¬146-148è¡Œï¼‰
- [x] selectedIntentçŠ¶æ€å·²æ·»åŠ ï¼ˆç¬¬151-153è¡Œï¼‰
- [x] selectedAlertsçŠ¶æ€å·²æ·»åŠ ï¼ˆç¬¬156è¡Œï¼‰

#### 1.2 äº‹ä»¶è®¢é˜…

- [x] visitor_intentäº‹ä»¶è®¢é˜…ï¼ˆç¬¬918-945è¡Œï¼‰
- [x] package_alertäº‹ä»¶è®¢é˜…ï¼ˆç¬¬948-985è¡Œï¼‰
- [x] visitor_intents_query_resultäº‹ä»¶è®¢é˜…ï¼ˆç¬¬988-1013è¡Œï¼‰
- [x] package_alerts_query_resultäº‹ä»¶è®¢é˜…ï¼ˆç¬¬1016-1041è¡Œï¼‰

#### 1.3 æ•°æ®åŠ è½½

- [x] ä»IndexedDBåŠ è½½è®¿å®¢æ„å›¾ç¼“å­˜ï¼ˆç¬¬211-217è¡Œï¼‰
- [x] ä»IndexedDBåŠ è½½å¿«é€’è­¦æŠ¥ç¼“å­˜ï¼ˆç¬¬219-225è¡Œï¼‰
- [x] åˆ‡æ¢åˆ°é¦–é¡µæ—¶è§¦å‘æŸ¥è¯¢ï¼ˆç¬¬237-253è¡Œï¼‰

#### 1.4 å¯¼èˆªå‡½æ•°

- [x] handleViewIntentDetailå‡½æ•°ï¼ˆç¬¬1119-1124è¡Œï¼‰
- [x] handleViewAllAlertså‡½æ•°ï¼ˆç¬¬1129-1133è¡Œï¼‰
- [x] handleBackToHomeå‡½æ•°ï¼ˆç¬¬1139-1144è¡Œï¼‰

#### 1.5 Toastç®¡ç†

- [x] addToastå‡½æ•°ï¼ˆç¬¬1152-1158è¡Œï¼‰
- [x] removeToastå‡½æ•°ï¼ˆç¬¬1165-1167è¡Œï¼‰
- [x] Toasté˜Ÿåˆ—æ¸²æŸ“ï¼ˆç¬¬1267-1283è¡Œï¼‰

### 2. æ•°æ®æµéªŒè¯ âœ…

#### 2.1 æ¨é€æ¶ˆæ¯æµç¨‹

```
Serveræ¨é€visitor_intent_notification
  â†“
DeviceServiceè§¦å‘visitor_intentäº‹ä»¶ï¼ˆç¬¬918è¡Œï¼‰
  â†“
App.tsxè®¢é˜…å¤„ç†ï¼ˆç¬¬918-945è¡Œï¼‰
  â†“
â”œâ”€ æ›´æ–°visitorIntentsçŠ¶æ€ï¼ˆç¬¬940è¡Œï¼‰
â”œâ”€ æ˜¾ç¤ºToasté€šçŸ¥ï¼ˆç¬¬943è¡Œï¼‰
â””â”€ ä¿å­˜åˆ°IndexedDBï¼ˆç¬¬946è¡Œï¼‰
```

#### 2.2 æŸ¥è¯¢ç»“æœæµç¨‹

```
ç”¨æˆ·åˆ‡æ¢åˆ°é¦–é¡µï¼ˆcurrentTab === "home"ï¼‰
  â†“
è§¦å‘æŸ¥è¯¢ï¼ˆç¬¬237-253è¡Œï¼‰
  â†“
DeviceService.queryVisitorIntents()
  â†“
Serverè¿”å›query_result
  â†“
DeviceServiceè§¦å‘visitor_intents_query_resultäº‹ä»¶
  â†“
App.tsxè®¢é˜…å¤„ç†ï¼ˆç¬¬988-1013è¡Œï¼‰
  â†“
â”œâ”€ æ•°æ®åˆå¹¶å»é‡ï¼ˆç¬¬993-1001è¡Œï¼‰
â””â”€ ä¿å­˜åˆ°IndexedDBï¼ˆç¬¬1004-1006è¡Œï¼‰
```

#### 2.3 UIå±•ç¤ºæµç¨‹

```
visitorIntentsçŠ¶æ€æ›´æ–°
  â†“
ä¼ é€’ç»™HomeScreenç»„ä»¶ï¼ˆç¬¬1203è¡Œï¼‰
  â†“
HomeScreenæ¸²æŸ“VisitorIntentCard
  â†“
ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"
  â†“
è°ƒç”¨onViewIntentDetailå›è°ƒï¼ˆç¬¬1206è¡Œï¼‰
  â†“
handleViewIntentDetailå‡½æ•°ï¼ˆç¬¬1119-1124è¡Œï¼‰
  â†“
è®¾ç½®selectedIntentå’ŒcurrentSubScreen
  â†“
æ¸²æŸ“VisitorIntentScreenï¼ˆç¬¬1186-1190è¡Œï¼‰
```

### 3. é¡µé¢åˆ‡æ¢å’Œå¯¼èˆª âœ…

#### 3.1 ä¸»Tabåˆ‡æ¢

- [x] homeã€monitorã€settingsä¸‰ä¸ªTabæ­£å¸¸åˆ‡æ¢
- [x] BottomNavç»„ä»¶é›†æˆï¼ˆç¬¬1260è¡Œï¼‰
- [x] handleTabChangeå‡½æ•°ï¼ˆç¬¬1093-1111è¡Œï¼‰

#### 3.2 è¯¦æƒ…é¡µå¯¼èˆª

- [x] è®¿å®¢æ„å›¾è¯¦æƒ…é¡µè·¯ç”±ï¼ˆç¬¬1186-1190è¡Œï¼‰
- [x] å¿«é€’è­¦æŠ¥è¯¦æƒ…é¡µè·¯ç”±ï¼ˆç¬¬1191-1195è¡Œï¼‰
- [x] è¿”å›é¦–é¡µåŠŸèƒ½ï¼ˆç¬¬1139-1144è¡Œï¼‰

#### 3.3 æ¡ä»¶æ¸²æŸ“é€»è¾‘

```typescript
{currentSubScreen === "visitor-intent-detail" && selectedIntent ? (
  <VisitorIntentScreen intent={selectedIntent} onBack={handleBackToHome} />
) : currentSubScreen === "package-alert-detail" ? (
  <PackageAlertScreen alerts={selectedAlerts} onBack={handleBackToHome} />
) : (
  // ä¸»Tabé¡µé¢
)}
```

### 4. ç»„ä»¶Propsä¼ é€’ âœ…

#### 4.1 HomeScreen Props

- [x] visitorIntentsï¼ˆç¬¬1203è¡Œï¼‰
- [x] packageAlertsï¼ˆç¬¬1204è¡Œï¼‰
- [x] onViewIntentDetailï¼ˆç¬¬1206è¡Œï¼‰
- [x] onViewAllAlertsï¼ˆç¬¬1207è¡Œï¼‰

#### 4.2 VisitorIntentScreen Props

- [x] intentï¼ˆç¬¬1187è¡Œï¼‰
- [x] onBackï¼ˆç¬¬1188è¡Œï¼‰

#### 4.3 PackageAlertScreen Props

- [x] alertsï¼ˆç¬¬1193è¡Œï¼‰
- [x] onBackï¼ˆç¬¬1194è¡Œï¼‰

### 5. é”™è¯¯å¤„ç† âœ…

#### 5.1 äº‹ä»¶å¤„ç†é”™è¯¯

- [x] visitor_intentäº‹ä»¶try-catchï¼ˆç¬¬920-947è¡Œï¼‰
- [x] package_alertäº‹ä»¶try-catchï¼ˆç¬¬950-987è¡Œï¼‰
- [x] æŸ¥è¯¢ç»“æœäº‹ä»¶try-catchï¼ˆç¬¬990-1015è¡Œï¼Œ1018-1043è¡Œï¼‰

#### 5.2 æ•°æ®åŠ è½½é”™è¯¯

- [x] ç¼“å­˜åŠ è½½é”™è¯¯å¤„ç†ï¼ˆç¬¬213-226è¡Œï¼‰
- [x] æŸ¥è¯¢è§¦å‘é”™è¯¯å¤„ç†ï¼ˆç¬¬247-251è¡Œï¼‰

### 6. æ€§èƒ½ä¼˜åŒ– âœ…

#### 6.1 æ•°æ®é™åˆ¶

- [x] å†…å­˜çŠ¶æ€ä¿ç•™æœ€è¿‘100æ¡ï¼ˆç¬¬940è¡Œï¼Œç¬¬975è¡Œï¼‰
- [x] é¦–é¡µå¡ç‰‡æ˜¾ç¤ºæœ€è¿‘5æ¡ï¼ˆHomeScreenç»„ä»¶å†…éƒ¨ï¼‰

#### 6.2 æ•°æ®å»é‡

- [x] è®¿å®¢æ„å›¾æŒ‰session_idå»é‡ï¼ˆç¬¬993-1001è¡Œï¼‰
- [x] å¿«é€’è­¦æŠ¥æŒ‰tså»é‡ï¼ˆç¬¬1023-1031è¡Œï¼‰

### 7. ç±»å‹å®‰å…¨ âœ…

#### 7.1 ç±»å‹å¯¼å…¥

```typescript
import {
  // ... å…¶ä»–ç±»å‹
  VisitorIntent,
  PackageAlert,
  SubScreen,
} from "./types";
```

#### 7.2 çŠ¶æ€ç±»å‹å£°æ˜

- [x] visitorIntents: VisitorIntent[]
- [x] packageAlerts: PackageAlert[]
- [x] currentSubScreen: SubScreen | null
- [x] selectedIntent: VisitorIntent | null
- [x] selectedAlerts: PackageAlert[]

## æ£€æŸ¥ç»“æœæ€»ç»“

### âœ… é€šè¿‡é¡¹ç›®

1. æ‰€æœ‰v2.5åè®®ç›¸å…³ç»„ä»¶å·²æ­£ç¡®é›†æˆåˆ°App.tsx
2. æ•°æ®æµå®Œæ•´ï¼šæ¨é€â†’çŠ¶æ€â†’UIâ†’IndexedDB
3. é¡µé¢åˆ‡æ¢å’Œå¯¼èˆªåŠŸèƒ½æ­£å¸¸
4. äº‹ä»¶è®¢é˜…å’Œå¤„ç†é€»è¾‘å®Œæ•´
5. é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
6. ç±»å‹å®‰å…¨å¾—åˆ°ä¿è¯

### ğŸ“‹ éªŒè¯æ–¹å¼

- ä»£ç å®¡æŸ¥ï¼šå·²æ£€æŸ¥App.tsxçš„æ‰€æœ‰ç›¸å…³ä»£ç 
- ç»“æ„éªŒè¯ï¼šç¡®è®¤æ‰€æœ‰çŠ¶æ€ã€å‡½æ•°ã€äº‹ä»¶è®¢é˜…éƒ½å·²æ­£ç¡®å®ç°
- æ•°æ®æµè¿½è¸ªï¼šéªŒè¯ä»æ¨é€åˆ°UIçš„å®Œæ•´è·¯å¾„
- å¯¼èˆªé€»è¾‘ï¼šç¡®è®¤é¡µé¢åˆ‡æ¢å’Œè¿”å›åŠŸèƒ½

### ğŸ¯ ç»“è®º

**ä»»åŠ¡21æ£€æŸ¥ç‚¹é€šè¿‡ï¼** æ‰€æœ‰v2.5åè®®é€‚é…ç»„ä»¶å·²æˆåŠŸé›†æˆåˆ°App.tsxï¼Œæ•°æ®æµæ­£å¸¸ï¼Œé¡µé¢å¯¼èˆªåŠŸèƒ½å®Œæ•´ã€‚
