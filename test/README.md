# 测试目录结构

本目录包含智能门锁 Pro 应用的所有测试文件，按测试类型分类组织。

## 目录结构

```
test/
├── unit/                    # 单元测试
│   ├── 组件测试             # UI 组件单元测试
│   ├── 服务测试             # 业务逻辑服务测试
│   ├── 协议测试             # 通信协议测试
│   └── 工具函数测试         # 辅助函数测试
├── integration/             # 集成测试
│   ├── 数据流测试           # 跨模块数据流测试
│   ├── 错误场景测试         # 异常处理集成测试
│   └── 检查点测试           # 功能检查点验证
├── e2e/                     # 端到端测试
│   ├── 功能测试             # 完整用户流程测试
│   ├── 跨浏览器测试         # 浏览器兼容性测试
│   └── 移动端测试           # 移动设备测试
├── accessibility/           # 无障碍测试
│   ├── 对比度测试           # 颜色对比度验证
│   ├── 键盘导航测试         # 键盘操作支持
│   └── 屏幕阅读器测试       # 辅助技术兼容性
├── performance/             # 性能测试
│   ├── IndexedDB 性能       # 本地存储性能
│   ├── 虚拟滚动性能         # 列表渲染优化
│   ├── 懒加载性能           # 图片加载优化
│   └── 构建优化测试         # 打包体积和速度
├── manual/                  # 手动测试文档
│   ├── 集成测试指南         # 手动集成测试步骤
│   ├── 主题切换测试         # UI 主题测试清单
│   └── 视觉测试文档         # 视觉回归测试
└── setup.ts                 # 测试环境配置

```

## 测试分类说明

### 单元测试 (unit/)

测试单个组件、函数或模块的独立功能。

**包含内容：**

- UI 组件测试（Button、Badge、Card、Screen 等）
- 服务层测试（DeviceService、LocalStorageService 等）
- 协议解析测试（BinaryProtocol、Commands 等）
- 业务逻辑测试（人脸管理、指纹管理、密码管理等）

**运行命令：**

```bash
npm test -- test/unit
```

### 集成测试 (integration/)

测试多个模块协同工作的场景。

**包含内容：**

- 数据流集成测试
- 错误处理集成测试
- 功能检查点验证

**运行命令：**

```bash
npm test -- test/integration
```

### 端到端测试 (e2e/)

模拟真实用户操作的完整流程测试。

**包含内容：**

- 功能测试（登录、监控、人脸注册等完整流程）
- 跨浏览器兼容性测试
- 移动端设备测试

**运行命令：**

```bash
npm test -- test/e2e
```

### 无障碍测试 (accessibility/)

验证应用的可访问性和包容性设计。

**包含内容：**

- 颜色对比度测试（WCAG 标准）
- 键盘导航支持测试
- 屏幕阅读器兼容性测试

**运行命令：**

```bash
npm test -- test/accessibility
```

### 性能测试 (performance/)

评估应用的性能指标和优化效果。

**包含内容：**

- IndexedDB 读写性能
- 虚拟滚动渲染性能
- 图片懒加载性能
- 构建打包优化

**运行命令：**

```bash
npm test -- test/performance
```

### 手动测试 (manual/)

需要人工执行的测试文档和清单。

**包含内容：**

- 集成测试指南
- 主题切换测试清单
- 视觉回归测试文档
- 功能测试总结报告

## 运行所有测试

```bash
npm test
```

## 测试覆盖率

```bash
npm run test:coverage
```

## 编写测试指南

### 命名规范

- 单元测试：`[模块名].test.ts` 或 `[组件名].test.tsx`
- 集成测试：`[功能模块]-integration.test.ts`
- 端到端测试：`[用户流程]-e2e.test.ts`

### 文件放置

- 测试单个组件/函数 → `unit/`
- 测试多模块交互 → `integration/`
- 测试完整用户流程 → `e2e/`
- 测试无障碍特性 → `accessibility/`
- 测试性能指标 → `performance/`

### 测试结构

```typescript
describe("模块名称", () => {
  beforeEach(() => {
    // 测试前准备
  });

  it("应该正确处理正常情况", () => {
    // 测试逻辑
  });

  it("应该正确处理异常情况", () => {
    // 异常测试
  });
});
```

## 持续集成

所有测试在 CI/CD 流程中自动运行：

- 单元测试：每次提交
- 集成测试：每次 PR
- 端到端测试：发布前
- 性能测试：每周定期运行

## 相关文档

- [测试策略文档](../docs/testing-strategy.md)
- [CI/CD 配置](../.github/workflows/)
- [代码覆盖率报告](../coverage/)
