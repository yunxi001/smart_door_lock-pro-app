# æ™ºèƒ½é—¨é” Pro - v2.5 åè®®é€‚é…å®æ–½è®¡åˆ’

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-19  
> **åè®®ç‰ˆæœ¬**: v2.5  
> **é¡¹ç›®**: æ™ºèƒ½é—¨é” Pro Web App

---

## ğŸ“‹ æ¦‚è¿°

### ç›®æ ‡

å°†æ™ºèƒ½é—¨é” Pro ä»åè®® v2.4 å‡çº§åˆ° v2.5ï¼Œå®Œæ•´æ”¯æŒä¸¤å¤§ AI åŠŸèƒ½ï¼š

- **è®¿å®¢æ„å›¾è¯†åˆ«**ï¼šå¯¹è¯å†å²ã€AI åˆ†æã€æ„å›¾åˆ†ç±»
- **å¿«é€’çœ‹æŠ¤è­¦æŠ¥**ï¼šå¨èƒæ£€æµ‹ã€è¡Œä¸ºåˆ†æã€ç…§ç‰‡è®°å½•

### æ ¸å¿ƒä»·å€¼

- æå‡ç”¨æˆ·å®‰å…¨æ„Ÿï¼ˆå¿«é€’é˜²ç›—ã€é™Œç”Ÿäººè¯†åˆ«ï¼‰
- å¢å¼ºæ™ºèƒ½åŒ–ä½“éªŒï¼ˆAI å¯¹è¯åˆ†æã€è‡ªåŠ¨åˆ†ç±»ï¼‰
- å®Œå–„æ•°æ®è®°å½•ï¼ˆå®Œæ•´å¯¹è¯å†å²ã€è­¦æŠ¥è¿½æº¯ï¼‰

### å®æ–½åŸåˆ™

- âœ… **å…¨åŠŸèƒ½å®ç°**ï¼šä¸¤ä¸ªæ¨¡å—åŒæ­¥å¼€å‘
- âœ… **æ•°æ®ä¼˜å…ˆ**ï¼šå…ˆå®Œæˆ Service + Storageï¼Œå†åš UI
- âœ… **æµ‹è¯•é©±åŠ¨**ï¼šç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–å…³é”®é€»è¾‘
- âœ… **ä¸¥æ ¼æŒ‰åè®®**ï¼šä»¥æ–‡æ¡£ä¸ºå‡†ï¼Œå‘ç°é—®é¢˜åä¿®æ”¹

---

## ğŸ¯ åŠŸèƒ½èŒƒå›´

### æ¨¡å— Aï¼šè®¿å®¢æ„å›¾è¯†åˆ«

| åŠŸèƒ½ç‚¹         | è¯´æ˜                                   | ä¼˜å…ˆçº§ |
| -------------- | -------------------------------------- | ------ |
| å®æ—¶æ¨é€æ¥æ”¶   | `visitor_intent_notification` æ¶ˆæ¯å¤„ç† | P0     |
| Toast é€šçŸ¥     | é¡¶éƒ¨ 3 ç§’è‡ªåŠ¨æ¶ˆå¤±æç¤º                  | P0     |
| é¦–é¡µå¡ç‰‡å±•ç¤º   | æœ€è¿‘ 5 æ¡è®°å½•æŠ˜å å¡ç‰‡                  | P0     |
| å¯¹è¯è¯¦æƒ…é¡µ     | èŠå¤©æ°”æ³¡æ ·å¼å±•ç¤ºå®Œæ•´å¯¹è¯               | P0     |
| å†å²è®°å½•æŸ¥è¯¢   | åˆ†é¡µæŸ¥è¯¢ã€æ—¥æœŸç­›é€‰                     | P1     |
| IndexedDB ç¼“å­˜ | å…¨é‡ç¼“å­˜åˆ°æœ¬åœ°                         | P0     |

### æ¨¡å— Bï¼šå¿«é€’çœ‹æŠ¤è­¦æŠ¥

| åŠŸèƒ½ç‚¹       | è¯´æ˜                          | ä¼˜å…ˆçº§ |
| ------------ | ----------------------------- | ------ |
| è­¦æŠ¥æ¨é€æ¥æ”¶ | å¿«é€’å¼‚å¸¸æ£€æµ‹æ¶ˆæ¯å¤„ç†          | P0     |
| å¨èƒç­‰çº§æç¤º | ä¸­å¨èƒæ©™è‰²é€šçŸ¥                | P0     |
| é¦–é¡µå¡ç‰‡å±•ç¤º | æœ€è¿‘ 5 æ¡è­¦æŠ¥è®°å½•             | P0     |
| è­¦æŠ¥è¯¦æƒ…é¡µ   | ç…§ç‰‡ã€è¡Œä¸ºåˆ†æå±•ç¤º            | P0     |
| ç…§ç‰‡æ‡’åŠ è½½   | ç¼©ç•¥å›¾ + IntersectionObserver | P1     |
| å†å²è®°å½•æŸ¥è¯¢ | å¨èƒç­‰çº§ç­›é€‰ã€åˆ†é¡µ            | P1     |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### UI å¸ƒå±€æ–¹æ¡ˆ

```
é¦–é¡µ (HomeScreen)
â”œâ”€â”€ è®¾å¤‡çŠ¶æ€å¡ç‰‡
â”œâ”€â”€ æœ€è¿‘åŠ¨æ€å¡ç‰‡
â”œâ”€â”€ ã€æ–°å¢ã€‘è®¿å®¢æ„å›¾å¡ç‰‡ â† æœ€è¿‘ 5 æ¡ï¼ŒæŠ˜å å±•ç¤º
â”‚   â”œâ”€â”€ æ„å›¾ç±»å‹æ ‡ç­¾ï¼ˆé€è´§/æ‹œè®¿/æ¨é”€/ç»´ä¿®/å…¶ä»–ï¼‰
â”‚   â”œâ”€â”€ ç®€è¦æ€»ç»“ï¼ˆä¸€å¥è¯ï¼‰
â”‚   â”œâ”€â”€ æ—¶é—´æˆ³
â”‚   â””â”€â”€ "æŸ¥çœ‹è¯¦æƒ…" æŒ‰é’® â†’ è·³è½¬åˆ° VisitorIntentScreen
â””â”€â”€ ã€æ–°å¢ã€‘å¿«é€’è­¦æŠ¥å¡ç‰‡ â† æœ€è¿‘ 5 æ¡
    â”œâ”€â”€ å¨èƒç­‰çº§æ ‡è¯†ï¼ˆä½/ä¸­/é«˜ï¼‰
    â”œâ”€â”€ è¡Œä¸ºç±»å‹ï¼ˆæ­£å¸¸/è·¯è¿‡/ç¿»çœ‹/æ‹¿èµ°/ç ´åï¼‰
    â”œâ”€â”€ ç¼©ç•¥å›¾
    â””â”€â”€ "æŸ¥çœ‹å…¨éƒ¨" æŒ‰é’® â†’ è·³è½¬åˆ° PackageAlertScreen

è®¿å®¢æ„å›¾è¯¦æƒ…é¡µ (VisitorIntentScreen)
â”œâ”€â”€ é¡¶éƒ¨ä¿¡æ¯æ ï¼ˆè®¿å®¢å§“åã€æ—¶é—´ã€æ„å›¾ç±»å‹ï¼‰
â”œâ”€â”€ AI åˆ†ææ‘˜è¦
â”œâ”€â”€ é‡è¦ä¿¡æ¯åˆ—è¡¨
â”œâ”€â”€ å¯¹è¯å†å²ï¼ˆèŠå¤©æ°”æ³¡ï¼Œè™šæ‹Ÿæ»šåŠ¨ï¼‰
â””â”€â”€ è¿”å›æŒ‰é’®

å¿«é€’è­¦æŠ¥è¯¦æƒ…é¡µ (PackageAlertScreen)
â”œâ”€â”€ é¡¶éƒ¨ä¿¡æ¯æ ï¼ˆæ—¶é—´ã€å¨èƒç­‰çº§ï¼‰
â”œâ”€â”€ è­¦æŠ¥ç…§ç‰‡ï¼ˆæ‡’åŠ è½½ï¼‰
â”œâ”€â”€ è¡Œä¸ºåˆ†æ
â”œâ”€â”€ è¯­éŸ³è­¦å‘ŠçŠ¶æ€
â””â”€â”€ å†å²è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
```

### æ•°æ®æµè®¾è®¡

```
æœåŠ¡å™¨æ¨é€
    â†“
DeviceService.handleTextMessage()
    â†“ emit('visitor_intent' | 'package_alert')
    â†“
App.tsx è®¢é˜…äº‹ä»¶
    â†“
â”œâ”€â†’ æ›´æ–°çŠ¶æ€ (visitorIntents / packageAlerts)
â”œâ”€â†’ æ˜¾ç¤º Toast é€šçŸ¥
â””â”€â†’ ä¿å­˜åˆ° IndexedDB (LocalStorageService)
    â†“
HomeScreen è¯»å–æœ€è¿‘ 5 æ¡
    â†“
ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"
    â†“
åˆ‡æ¢åˆ°è¯¦æƒ…é¡µ Screen
```

### çŠ¶æ€ç®¡ç†

**App.tsx æ–°å¢çŠ¶æ€ï¼š**

```typescript
// è®¿å®¢æ„å›¾è®°å½•
const [visitorIntents, setVisitorIntents] = useState<VisitorIntent[]>([]);

// å¿«é€’è­¦æŠ¥è®°å½•
const [packageAlerts, setPackageAlerts] = useState<PackageAlert[]>([]);

// Toast é€šçŸ¥çŠ¶æ€
const [toastMessage, setToastMessage] = useState<string | null>(null);
```

---

## ğŸ“¦ æ•°æ®æ¨¡å‹

### TypeScript æ¥å£å®šä¹‰

**types.ts æ–°å¢æ¥å£ï¼š**

```typescript
// è®¿å®¢æ„å›¾è®°å½•
export interface VisitorIntent {
  id: number;
  visit_id: number;
  session_id: string;
  person_id: number | null;
  person_name: string;
  relation_type: "family" | "friend" | "unknown";
  intent_type: "delivery" | "visit" | "sales" | "maintenance" | "other";
  intent_summary: {
    intent_type: string;
    summary: string;
    important_notes: string[];
    ai_analysis: string;
  };
  dialogue_history: DialogueMessage[];
  package_check?: PackageCheck;
  created_at: string;
  ts: number;
}

// å¯¹è¯æ¶ˆæ¯
export interface DialogueMessage {
  role: "assistant" | "user";
  content: string;
}

// å¿«é€’æ£€æŸ¥ç»“æœ
export interface PackageCheck {
  threat_level: "low" | "medium" | "high";
  action: "normal" | "passing" | "searching" | "taking" | "damaging";
  description: string;
}

// å¿«é€’è­¦æŠ¥è®°å½•
export interface PackageAlert {
  id: number;
  device_id: string;
  session_id: string;
  threat_level: "low" | "medium" | "high";
  action: "normal" | "passing" | "searching" | "taking" | "damaging";
  description: string;
  photo_path: string;
  photo_thumbnail?: string; // ç¼©ç•¥å›¾è·¯å¾„ï¼ˆå‰ç«¯ç”Ÿæˆï¼‰
  voice_warning_sent: boolean;
  notified: boolean;
  created_at: string;
  ts: number;
}
```

### IndexedDB Schema

**LocalStorageService æ–°å¢ ObjectStoreï¼š**

```typescript
// æ•°æ®åº“ç‰ˆæœ¬å‡çº§åˆ° v3
const DB_VERSION = 3;

// æ–°å¢ä¸¤ä¸ª ObjectStore
db.createObjectStore("visitor_intents", { keyPath: "id", autoIncrement: true });
db.createObjectStore("package_alerts", { keyPath: "id", autoIncrement: true });

// ç´¢å¼•è®¾è®¡
visitorIntentsStore.createIndex("ts", "ts", { unique: false });
visitorIntentsStore.createIndex("intent_type", "intent_type", {
  unique: false,
});

packageAlertsStore.createIndex("ts", "ts", { unique: false });
packageAlertsStore.createIndex("threat_level", "threat_level", {
  unique: false,
});
```

---

## ğŸ”§ æŠ€æœ¯å®ç°æ¸…å•

### é˜¶æ®µ 1ï¼šæ•°æ®å±‚å®ç°ï¼ˆService + Storageï¼‰

#### 1.1 types.ts æ›´æ–°

- [ ] æ–°å¢ `VisitorIntent` æ¥å£
- [ ] æ–°å¢ `PackageAlert` æ¥å£
- [ ] æ–°å¢ `DialogueMessage` æ¥å£
- [ ] æ–°å¢ `PackageCheck` æ¥å£
- [ ] æ–°å¢æ„å›¾ç±»å‹æšä¸¾ `IntentType`
- [ ] æ–°å¢å¨èƒç­‰çº§æšä¸¾ `ThreatLevel`

#### 1.2 DeviceService.ts æ›´æ–°

**æ¶ˆæ¯å¤„ç†ï¼š**

- [ ] `handleTextMessage()` æ·»åŠ  `visitor_intent_notification` åˆ†æ”¯
- [ ] æ–°å¢ `handleVisitorIntentNotification()` æ–¹æ³•
- [ ] æ–°å¢ `handlePackageAlertNotification()` æ–¹æ³•ï¼ˆä» `visitor_intent_notification.package_check` æå–ï¼‰
- [ ] emit æ–°äº‹ä»¶ï¼š`visitor_intent` å’Œ `package_alert`

**æŸ¥è¯¢æ–¹æ³•ï¼š**

- [ ] æ–°å¢ `queryVisitorIntents(params)` æ–¹æ³•
  - å‚æ•°ï¼š`start_date`, `end_date`, `limit`, `offset`
  - å‘é€ `query` æ¶ˆæ¯ï¼Œtarget ä¸º `visitor_intents`
- [ ] æ–°å¢ `queryPackageAlerts(params)` æ–¹æ³•
  - å‚æ•°ï¼š`threat_level`, `start_date`, `end_date`, `limit`, `offset`
  - å‘é€ `query` æ¶ˆæ¯ï¼Œtarget ä¸º `package_alerts`

**handleQueryResult() æ›´æ–°ï¼š**

- [ ] æ·»åŠ  `visitor_intents` target å¤„ç†
- [ ] æ·»åŠ  `package_alerts` target å¤„ç†
- [ ] emit å¯¹åº”çš„æŸ¥è¯¢ç»“æœäº‹ä»¶

**Mock æ•°æ®ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰ï¼š**

- [ ] æ·»åŠ  `mockVisitorIntentPush()` æ–¹æ³•ï¼ˆæ¨¡æ‹Ÿæ¨é€ï¼‰
- [ ] æ·»åŠ  `mockPackageAlertPush()` æ–¹æ³•ï¼ˆæ¨¡æ‹Ÿæ¨é€ï¼‰

#### 1.3 LocalStorageService.ts æ›´æ–°

**æ•°æ®åº“å‡çº§ï¼š**

- [ ] å‡çº§ `DB_VERSION` åˆ° 3
- [ ] `onupgradeneeded` ä¸­åˆ›å»º `visitor_intents` ObjectStore
- [ ] `onupgradeneeded` ä¸­åˆ›å»º `package_alerts` ObjectStore
- [ ] æ·»åŠ ç´¢å¼•ï¼š`ts`, `intent_type`, `threat_level`

**CRUD æ–¹æ³•ï¼š**

- [ ] `saveVisitorIntent(intent: VisitorIntent)` - ä¿å­˜å•æ¡è®°å½•
- [ ] `getVisitorIntents(limit?: number)` - è·å–æœ€è¿‘ N æ¡
- [ ] `getAllVisitorIntents()` - è·å–å…¨éƒ¨ï¼ˆç”¨äºè¯¦æƒ…é¡µï¼‰
- [ ] `deleteVisitorIntent(id: number)` - åˆ é™¤è®°å½•
- [ ] `savePackageAlert(alert: PackageAlert)` - ä¿å­˜å•æ¡è®°å½•
- [ ] `getPackageAlerts(limit?: number)` - è·å–æœ€è¿‘ N æ¡
- [ ] `getAllPackageAlerts()` - è·å–å…¨éƒ¨ï¼ˆç”¨äºè¯¦æƒ…é¡µï¼‰
- [ ] `deletePackageAlert(id: number)` - åˆ é™¤è®°å½•

**ç¼“å­˜åŠ è½½ï¼š**

- [ ] `loadCachedData()` ä¸­æ·»åŠ è®¿å®¢æ„å›¾å’Œå¿«é€’è­¦æŠ¥åŠ è½½

---

### é˜¶æ®µ 2ï¼šUI å±‚å®ç°ï¼ˆComponents + Screensï¼‰

#### 2.1 é€šç”¨ç»„ä»¶

**components/ChatBubble.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] åˆ›å»ºèŠå¤©æ°”æ³¡ç»„ä»¶
- [ ] Props: `role`, `content`, `timestamp`
- [ ] æ ·å¼ï¼šå·¦å¯¹é½ï¼ˆassistantï¼‰ã€å³å¯¹é½ï¼ˆuserï¼‰
- [ ] æ”¯æŒé•¿æ–‡æœ¬è‡ªåŠ¨æ¢è¡Œ
- [ ] å¯å¤ç”¨äºæœªæ¥å¯¹è®²åŠŸèƒ½

**components/ThreatLevelBadge.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] åˆ›å»ºå¨èƒç­‰çº§æ ‡è¯†ç»„ä»¶
- [ ] Props: `level` ('low' | 'medium' | 'high')
- [ ] é¢œè‰²ï¼šç»¿è‰²ï¼ˆä½ï¼‰ã€æ©™è‰²ï¼ˆä¸­ï¼‰ã€çº¢è‰²ï¼ˆé«˜ï¼‰
- [ ] å›¾æ ‡ + æ–‡å­—

**components/IntentTypeBadge.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] åˆ›å»ºæ„å›¾ç±»å‹æ ‡ç­¾ç»„ä»¶
- [ ] Props: `type` (delivery/visit/sales/maintenance/other)
- [ ] ä¸åŒç±»å‹ä¸åŒé¢œè‰²å’Œå›¾æ ‡

**components/Toast.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] åˆ›å»ºé¡¶éƒ¨ Toast é€šçŸ¥ç»„ä»¶
- [ ] Props: `message`, `duration`, `onClose`
- [ ] 3 ç§’åè‡ªåŠ¨æ¶ˆå¤±
- [ ] æ”¯æŒæ‰‹åŠ¨å…³é—­

#### 2.2 é¦–é¡µå¡ç‰‡

**components/VisitorIntentCard.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] æ˜¾ç¤ºæœ€è¿‘ 5 æ¡è®¿å®¢æ„å›¾
- [ ] æŠ˜å å¡ç‰‡æ ·å¼ï¼ˆæ¯æ¡ä¸€è¡Œï¼‰
- [ ] æ˜¾ç¤ºï¼šæ„å›¾ç±»å‹ã€ç®€è¦æ€»ç»“ã€æ—¶é—´
- [ ] "æŸ¥çœ‹è¯¦æƒ…" æŒ‰é’®
- [ ] ç©ºçŠ¶æ€æç¤º

**components/PackageAlertCard.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] æ˜¾ç¤ºæœ€è¿‘ 5 æ¡å¿«é€’è­¦æŠ¥
- [ ] æ˜¾ç¤ºï¼šå¨èƒç­‰çº§ã€è¡Œä¸ºç±»å‹ã€ç¼©ç•¥å›¾ã€æ—¶é—´
- [ ] "æŸ¥çœ‹å…¨éƒ¨" æŒ‰é’®
- [ ] ç©ºçŠ¶æ€æç¤º

**screens/HomeScreen.tsx æ›´æ–°**

- [ ] å¼•å…¥ `VisitorIntentCard` å’Œ `PackageAlertCard`
- [ ] æ¥æ”¶ props: `visitorIntents`, `packageAlerts`
- [ ] æ·»åŠ å¡ç‰‡åˆ°å¸ƒå±€ï¼ˆåœ¨æœ€è¿‘åŠ¨æ€ä¸‹æ–¹ï¼‰
- [ ] ç‚¹å‡»äº‹ä»¶ï¼šåˆ‡æ¢åˆ°è¯¦æƒ…é¡µ

#### 2.3 è¯¦æƒ…é¡µé¢

**screens/VisitorIntentScreen.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] é¡¶éƒ¨ä¿¡æ¯æ ï¼ˆè®¿å®¢å§“åã€æ—¶é—´ã€æ„å›¾ç±»å‹ï¼‰
- [ ] AI åˆ†ææ‘˜è¦å¡ç‰‡
- [ ] é‡è¦ä¿¡æ¯åˆ—è¡¨ï¼ˆimportant_notesï¼‰
- [ ] å¯¹è¯å†å²åŒºåŸŸï¼ˆä½¿ç”¨ ChatBubble ç»„ä»¶ï¼‰
- [ ] è™šæ‹Ÿæ»šåŠ¨å®ç°ï¼ˆreact-window æˆ– react-virtuosoï¼‰
- [ ] è¿”å›æŒ‰é’®
- [ ] åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

**screens/PackageAlertScreen.tsx**ï¼ˆæ–°å»ºï¼‰

- [ ] é¡¶éƒ¨ä¿¡æ¯æ ï¼ˆæ—¶é—´ã€å¨èƒç­‰çº§ï¼‰
- [ ] è­¦æŠ¥ç…§ç‰‡å±•ç¤ºï¼ˆæ‡’åŠ è½½ï¼‰
- [ ] è¡Œä¸ºåˆ†æå¡ç‰‡
- [ ] è¯­éŸ³è­¦å‘ŠçŠ¶æ€æ˜¾ç¤º
- [ ] å†å²è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µåŠ è½½ï¼‰
- [ ] å¨èƒç­‰çº§ç­›é€‰å™¨
- [ ] è¿”å›æŒ‰é’®
- [ ] åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

#### 2.4 App.tsx æ›´æ–°

**çŠ¶æ€ç®¡ç†ï¼š**

- [ ] æ–°å¢ `visitorIntents` çŠ¶æ€
- [ ] æ–°å¢ `packageAlerts` çŠ¶æ€
- [ ] æ–°å¢ `toastMessage` çŠ¶æ€

**äº‹ä»¶è®¢é˜…ï¼š**

- [ ] è®¢é˜… `visitor_intent` äº‹ä»¶
  - æ›´æ–°çŠ¶æ€
  - æ˜¾ç¤º Toast é€šçŸ¥
  - ä¿å­˜åˆ° IndexedDB
- [ ] è®¢é˜… `package_alert` äº‹ä»¶
  - æ›´æ–°çŠ¶æ€
  - ä¸­å¨èƒæ˜¾ç¤ºæ©™è‰² Toast
  - ä¿å­˜åˆ° IndexedDB

**æ•°æ®åŠ è½½ï¼š**

- [ ] `useEffect` ä¸­åŠ è½½ç¼“å­˜çš„è®¿å®¢æ„å›¾å’Œå¿«é€’è­¦æŠ¥
- [ ] åˆ‡æ¢åˆ°é¦–é¡µæ—¶æŸ¥è¯¢æœ€æ–°æ•°æ®ï¼ˆ`currentTab === 'home'`ï¼‰

**è·¯ç”±æ‰©å±•ï¼š**

- [ ] æ”¯æŒ `currentTab` ä¸º `visitor_intent_detail` å’Œ `package_alert_detail`
- [ ] ä¼ é€’å¿…è¦çš„ props åˆ°è¯¦æƒ…é¡µ

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

#### DeviceService æµ‹è¯•

**test/visitorIntent.test.ts**ï¼ˆæ–°å»ºï¼‰

- [ ] æµ‹è¯• `handleVisitorIntentNotification()` æ¶ˆæ¯è§£æ
- [ ] æµ‹è¯• `queryVisitorIntents()` æŸ¥è¯¢å‚æ•°æ„é€ 
- [ ] æµ‹è¯• `handleQueryResult()` ä¸­ `visitor_intents` åˆ†æ”¯
- [ ] æµ‹è¯•äº‹ä»¶ emit æ˜¯å¦æ­£ç¡®è§¦å‘
- [ ] æµ‹è¯• Mock æ•°æ®æ¨é€åŠŸèƒ½

**test/packageAlert.test.ts**ï¼ˆæ–°å»ºï¼‰

- [ ] æµ‹è¯•å¿«é€’è­¦æŠ¥æ¶ˆæ¯è§£æ
- [ ] æµ‹è¯• `queryPackageAlerts()` æŸ¥è¯¢å‚æ•°
- [ ] æµ‹è¯•å¨èƒç­‰çº§ç­›é€‰é€»è¾‘
- [ ] æµ‹è¯•äº‹ä»¶ emit æ˜¯å¦æ­£ç¡®è§¦å‘

#### LocalStorageService æµ‹è¯•

**test/localStorageService-v2.5.test.ts**ï¼ˆæ–°å»ºï¼‰

- [ ] æµ‹è¯•æ•°æ®åº“å‡çº§åˆ° v3
- [ ] æµ‹è¯• `saveVisitorIntent()` ä¿å­˜åŠŸèƒ½
- [ ] æµ‹è¯• `getVisitorIntents()` æŸ¥è¯¢åŠŸèƒ½
- [ ] æµ‹è¯• `savePackageAlert()` ä¿å­˜åŠŸèƒ½
- [ ] æµ‹è¯• `getPackageAlerts()` æŸ¥è¯¢åŠŸèƒ½
- [ ] æµ‹è¯•ç´¢å¼•æŸ¥è¯¢æ€§èƒ½

### é›†æˆæµ‹è¯•

**test/v2.5-integration.test.ts**ï¼ˆæ–°å»ºï¼‰

- [ ] æµ‹è¯•å®Œæ•´æ•°æ®æµï¼šæ¨é€ â†’ å­˜å‚¨ â†’ æŸ¥è¯¢ â†’ å±•ç¤º
- [ ] æµ‹è¯• Toast é€šçŸ¥è§¦å‘
- [ ] æµ‹è¯•é¦–é¡µå¡ç‰‡æ•°æ®æ›´æ–°
- [ ] æµ‹è¯•è¯¦æƒ…é¡µæ•°æ®åŠ è½½
- [ ] æµ‹è¯•åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½

### æ‰‹åŠ¨æµ‹è¯•æ¸…å•

#### è®¿å®¢æ„å›¾åŠŸèƒ½

- [ ] æ¥æ”¶æ¨é€æ¶ˆæ¯ï¼ŒToast æ­£å¸¸æ˜¾ç¤º
- [ ] é¦–é¡µå¡ç‰‡æ˜¾ç¤ºæœ€è¿‘ 5 æ¡è®°å½•
- [ ] ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"è·³è½¬åˆ°è¯¦æƒ…é¡µ
- [ ] å¯¹è¯å†å²æ­£ç¡®å±•ç¤ºï¼ˆæ°”æ³¡æ ·å¼ï¼‰
- [ ] è™šæ‹Ÿæ»šåŠ¨æµç•…ï¼ˆæµ‹è¯• 100+ æ¡å¯¹è¯ï¼‰
- [ ] AI åˆ†æå’Œé‡è¦ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [ ] è¿”å›æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] æ•°æ®æŒä¹…åŒ–ï¼ˆåˆ·æ–°é¡µé¢åä»å­˜åœ¨ï¼‰

#### å¿«é€’è­¦æŠ¥åŠŸèƒ½

- [ ] æ¥æ”¶è­¦æŠ¥æ¶ˆæ¯ï¼Œä¸­å¨èƒæ˜¾ç¤ºæ©™è‰² Toast
- [ ] é¦–é¡µå¡ç‰‡æ˜¾ç¤ºæœ€è¿‘ 5 æ¡è­¦æŠ¥
- [ ] å¨èƒç­‰çº§æ ‡è¯†é¢œè‰²æ­£ç¡®
- [ ] ç‚¹å‡»"æŸ¥çœ‹å…¨éƒ¨"è·³è½¬åˆ°è¯¦æƒ…é¡µ
- [ ] ç…§ç‰‡æ‡’åŠ è½½æ­£å¸¸å·¥ä½œ
- [ ] å¨èƒç­‰çº§ç­›é€‰åŠŸèƒ½æ­£å¸¸
- [ ] åˆ†é¡µåŠ è½½æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–

#### è¾¹ç•Œæƒ…å†µ

- [ ] æ— æ•°æ®æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€
- [ ] æŸ¥è¯¢å¤±è´¥æ˜¾ç¤ºé‡è¯•æŒ‰é’®
- [ ] ç½‘ç»œæ–­å¼€åé‡è¿ï¼Œæ•°æ®åŒæ­¥æ­£å¸¸
- [ ] å¯¹è¯å†å²ä¸ºç©ºæ—¶çš„å¤„ç†
- [ ] ç…§ç‰‡åŠ è½½å¤±è´¥çš„é™çº§å¤„ç†

---

## ğŸ“… å®æ–½è®¡åˆ’

### å¼€å‘é¡ºåº

**ç¬¬ 1 æ­¥ï¼šæ•°æ®å±‚åŸºç¡€ï¼ˆé¢„è®¡ 1-2 å¤©ï¼‰**

1. æ›´æ–° `types.ts` æ¥å£å®šä¹‰
2. å‡çº§ `LocalStorageService` æ•°æ®åº“åˆ° v3
3. å®ç° CRUD æ–¹æ³•
4. ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯

**ç¬¬ 2 æ­¥ï¼šDeviceService æ‰©å±•ï¼ˆé¢„è®¡ 1 å¤©ï¼‰**

1. æ·»åŠ æ¶ˆæ¯å¤„ç†æ–¹æ³•
2. æ·»åŠ æŸ¥è¯¢æ–¹æ³•
3. æ·»åŠ  Mock æ•°æ®åŠŸèƒ½
4. ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯

**ç¬¬ 3 æ­¥ï¼šé€šç”¨ç»„ä»¶å¼€å‘ï¼ˆé¢„è®¡ 1 å¤©ï¼‰**

1. åˆ›å»º `ChatBubble` ç»„ä»¶
2. åˆ›å»º `ThreatLevelBadge` ç»„ä»¶
3. åˆ›å»º `IntentTypeBadge` ç»„ä»¶
4. åˆ›å»º `Toast` ç»„ä»¶
5. æ‰‹åŠ¨æµ‹è¯•ç»„ä»¶æ ·å¼

**ç¬¬ 4 æ­¥ï¼šé¦–é¡µå¡ç‰‡é›†æˆï¼ˆé¢„è®¡ 1 å¤©ï¼‰**

1. åˆ›å»º `VisitorIntentCard` ç»„ä»¶
2. åˆ›å»º `PackageAlertCard` ç»„ä»¶
3. æ›´æ–° `HomeScreen.tsx`
4. æ›´æ–° `App.tsx` çŠ¶æ€ç®¡ç†
5. æµ‹è¯•æ•°æ®æµå’Œ Toast é€šçŸ¥

**ç¬¬ 5 æ­¥ï¼šè¯¦æƒ…é¡µé¢å¼€å‘ï¼ˆé¢„è®¡ 2 å¤©ï¼‰**

1. åˆ›å»º `VisitorIntentScreen.tsx`
2. å®ç°è™šæ‹Ÿæ»šåŠ¨
3. åˆ›å»º `PackageAlertScreen.tsx`
4. å®ç°ç…§ç‰‡æ‡’åŠ è½½
5. å®ç°åˆ†é¡µæŸ¥è¯¢
6. æµ‹è¯•äº¤äº’å’Œæ€§èƒ½

**ç¬¬ 6 æ­¥ï¼šé›†æˆæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆé¢„è®¡ 1 å¤©ï¼‰**

1. ç¼–å†™é›†æˆæµ‹è¯•
2. æ‰‹åŠ¨æµ‹è¯•æ‰€æœ‰åœºæ™¯
3. æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨ã€æ‡’åŠ è½½ï¼‰
4. ä¿®å¤å‘ç°çš„ Bug

**æ€»è®¡ï¼šé¢„è®¡ 7-8 å¤©**

### é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘           | å®Œæˆæ ‡å¿—                             | é¢„è®¡æ—¶é—´ |
| ---------------- | ------------------------------------ | -------- |
| M1: æ•°æ®å±‚å®Œæˆ   | æ‰€æœ‰ Service å’Œ Storage å•å…ƒæµ‹è¯•é€šè¿‡ | Day 3    |
| M2: é¦–é¡µé›†æˆå®Œæˆ | é¦–é¡µå¡ç‰‡æ­£å¸¸æ˜¾ç¤ºï¼ŒToast é€šçŸ¥æ­£å¸¸     | Day 5    |
| M3: è¯¦æƒ…é¡µå®Œæˆ   | ä¸¤ä¸ªè¯¦æƒ…é¡µåŠŸèƒ½å®Œæ•´ï¼Œäº¤äº’æµç•…         | Day 7    |
| M4: æµ‹è¯•é€šè¿‡     | æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ— å·²çŸ¥ Bug             | Day 8    |

---

## âš ï¸ é£é™©å’Œåº”å¯¹

### æŠ€æœ¯é£é™©

| é£é™©               | å½±å“                   | åº”å¯¹æ–¹æ¡ˆ                                     |
| ------------------ | ---------------------- | -------------------------------------------- |
| è™šæ‹Ÿæ»šåŠ¨æ€§èƒ½é—®é¢˜   | å¯¹è¯å†å²è¿‡é•¿æ—¶å¡é¡¿     | ä½¿ç”¨æˆç†Ÿåº“ï¼ˆreact-windowï¼‰ï¼Œé™åˆ¶å•æ¬¡æ¸²æŸ“æ•°é‡ |
| IndexedDB å†™å…¥å»¶è¿Ÿ | å¤§é‡æ•°æ®ä¿å­˜æ—¶é˜»å¡ UI  | ä½¿ç”¨ Web Worker æˆ–æ‰¹é‡å†™å…¥                   |
| ç…§ç‰‡åŠ è½½æ…¢         | ç”¨æˆ·ä½“éªŒå·®             | å®ç°ç¼©ç•¥å›¾ + æ‡’åŠ è½½ + å ä½ç¬¦                 |
| åè®®ç†è§£åå·®       | æœåŠ¡å™¨å®ç°ä¸æ–‡æ¡£ä¸ä¸€è‡´ | ä¸¥æ ¼æŒ‰æ–‡æ¡£å®ç°ï¼Œå‘ç°é—®é¢˜ååè°ƒä¿®æ”¹           |

### ä¸šåŠ¡é£é™©

| é£é™©           | å½±å“                   | åº”å¯¹æ–¹æ¡ˆ                           |
| -------------- | ---------------------- | ---------------------------------- |
| æ•°æ®é‡çˆ†ç‚¸     | IndexedDB å­˜å‚¨ç©ºé—´ä¸è¶³ | å®ç°æ•°æ®æ¸…ç†ç­–ç•¥ï¼ˆä¿ç•™æœ€è¿‘ 30 å¤©ï¼‰ |
| ç”¨æˆ·éšç§æ‹…å¿§   | å¯¹è¯å†å²æ•æ„Ÿ           | æ·»åŠ æ•°æ®æ¸…é™¤åŠŸèƒ½ï¼Œæ˜ç¡®éšç§æ”¿ç­–     |
| Toast é€šçŸ¥è¿‡å¤š | æ‰“æ‰°ç”¨æˆ·               | æ·»åŠ é€šçŸ¥å¼€å…³ï¼Œæ”¯æŒå…æ‰“æ‰°æ¨¡å¼       |

### å…¼å®¹æ€§é£é™©

| é£é™©           | å½±å“                          | åº”å¯¹æ–¹æ¡ˆ                           |
| -------------- | ----------------------------- | ---------------------------------- |
| æ—§ç‰ˆæœ¬æ•°æ®è¿ç§» | å‡çº§åæ•°æ®ä¸¢å¤±                | IndexedDB ç‰ˆæœ¬å‡çº§è„šæœ¬ï¼Œä¿ç•™æ—§æ•°æ® |
| æµè§ˆå™¨å…¼å®¹æ€§   | éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒ IndexedDB v3 | é™çº§åˆ°å†…å­˜å­˜å‚¨ï¼Œæç¤ºç”¨æˆ·å‡çº§æµè§ˆå™¨ |

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§

- [ ] èƒ½æ¥æ”¶å¹¶æ­£ç¡®è§£æ `visitor_intent_notification` æ¶ˆæ¯
- [ ] èƒ½æ¥æ”¶å¹¶æ­£ç¡®è§£æå¿«é€’è­¦æŠ¥æ¶ˆæ¯
- [ ] Toast é€šçŸ¥æ­£å¸¸æ˜¾ç¤ºï¼ˆ3 ç§’è‡ªåŠ¨æ¶ˆå¤±ï¼‰
- [ ] é¦–é¡µå¡ç‰‡æ˜¾ç¤ºæœ€è¿‘ 5 æ¡è®°å½•
- [ ] è¯¦æƒ…é¡µæ­£ç¡®å±•ç¤ºå®Œæ•´æ•°æ®
- [ ] å¯¹è¯å†å²ä½¿ç”¨èŠå¤©æ°”æ³¡æ ·å¼
- [ ] è™šæ‹Ÿæ»šåŠ¨æµç•…ï¼ˆ100+ æ¡å¯¹è¯æ— å¡é¡¿ï¼‰
- [ ] ç…§ç‰‡æ‡’åŠ è½½æ­£å¸¸å·¥ä½œ
- [ ] åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–åˆ° IndexedDB
- [ ] æŸ¥è¯¢å¤±è´¥æ˜¾ç¤ºé‡è¯•æŒ‰é’®

### æ€§èƒ½æŒ‡æ ‡

- [ ] é¦–é¡µå¡ç‰‡æ¸²æŸ“æ—¶é—´ < 100ms
- [ ] è¯¦æƒ…é¡µé¦–å±åŠ è½½æ—¶é—´ < 500ms
- [ ] è™šæ‹Ÿæ»šåŠ¨ FPS > 50
- [ ] IndexedDB å†™å…¥å»¶è¿Ÿ < 50ms
- [ ] ç…§ç‰‡æ‡’åŠ è½½è§¦å‘åŠæ—¶ï¼ˆè¿›å…¥è§†å£å 200ms å†…åŠ è½½ï¼‰

### ä»£ç è´¨é‡

- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ—  TypeScript ç±»å‹é”™è¯¯
- [ ] æ—  ESLint è­¦å‘Š
- [ ] ä»£ç æ³¨é‡Šå®Œæ•´ï¼ˆä¸­æ–‡ï¼‰

### ç”¨æˆ·ä½“éªŒ

- [ ] UI ç¬¦åˆç§»åŠ¨ç«¯è®¾è®¡è§„èŒƒ
- [ ] äº¤äº’æµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- [ ] é”™è¯¯æç¤ºæ¸…æ™°æ˜“æ‡‚
- [ ] ç©ºçŠ¶æ€æç¤ºå‹å¥½
- [ ] åŠ è½½çŠ¶æ€æ˜ç¡®

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [æ™ºèƒ½çŒ«çœ¼é—¨é”ç³»ç»Ÿ-æœåŠ¡å™¨ä¸Appé€šä¿¡åè®®è§„èŒƒ-v2.5.md](./æ™ºèƒ½çŒ«çœ¼é—¨é”ç³»ç»Ÿ-æœåŠ¡å™¨ä¸Appé€šä¿¡åè®®è§„èŒƒ-v2.5.md)
- [é¡¹ç›®ç»“æ„è§„èŒƒ (structure.md)](./.kiro/steering/structure.md)
- [äº§å“æ¦‚è¿° (product.md)](./.kiro/steering/product.md)
- [æŠ€æœ¯æ ˆè§„èŒƒ (tech.md)](./.kiro/steering/tech.md)

---

## ğŸ“ å˜æ›´æ—¥å¿—

| æ—¥æœŸ       | ç‰ˆæœ¬ | å˜æ›´å†…å®¹                         |
| ---------- | ---- | -------------------------------- |
| 2026-02-19 | v1.0 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæˆæ·±åº¦è®¿è°ˆå’Œè®¡åˆ’åˆ¶å®š |

---

**æ–‡æ¡£ç»´æŠ¤è€…**: æ™ºèƒ½é—¨é” Pro é¡¹ç›®ç»„  
**æœ€åæ›´æ–°**: 2026-02-19
