# 实施计划：智能门锁 Pro 配色系统重设计

## 概述

本实施计划将配色系统重设计功能分解为离散的编码任务。新配色系统将建立完整的色彩体系，支持浅色和深色两种主题模式，确保可访问性和品牌识别度。

## 任务列表

- [x] 1. 更新 Tailwind CSS 配置
  - [x] 1.1 修改 tailwind.config.js 添加新的颜色定义
    - 添加 primary（科技蓝）色阶 50-950
    - 添加 secondary（智能灰）色阶 50-950
    - 添加 success（安全绿）色阶 50-950
    - 添加 warning（注意橙）色阶 50-950
    - 添加 error（危险红）色阶 50-950
    - 添加 info（信息蓝）色阶 50-950
    - 配置 darkMode: 'class'
    - 配置字体系列（支持中文）
    - 配置阴影系统
    - _需求: 1.1, 1.2, 1.3, 1.4, 5.1, 5.2_
  - [x] 1.2 验证 Tailwind 配置
    - 运行构建命令确保配置无错误
    - 创建测试页面验证新颜色类名可用
    - 测试深色模式类名（dark:）是否生效
    - _需求: 5.1, 5.2, 5.3_

- [x] 2. 实现主题切换功能
  - [x] 2.1 在 App.tsx 中添加主题状态管理
    - 添加 theme 状态（'light' | 'dark'）
    - 从 localStorage 读取用户偏好
    - 根据系统偏好设置初始主题
    - _需求: 3.1, 3.2_
  - [x] 2.2 实现主题切换逻辑
    - 创建 toggleTheme 函数
    - 切换时更新 document.documentElement 的 class
    - 保存用户偏好到 localStorage
    - _需求: 3.3_
  - [x] 2.3 添加主题切换 UI
    - 在设置页添加主题切换开关
    - 显示当前主题状态
    - 添加切换动画效果
    - _需求: 3.1, 3.2, 3.3_

- [x] 3. 创建配色系统文档
  - [x] 3.1 创建 docs/color-system.md
    - 记录所有颜色定义和用途
    - 提供使用示例代码
    - 添加常用配色组合速查表
    - 说明可访问性要求
    - _需求: 1.5, 5.4, 5.5, 7.1_
  - [x] 3.2 更新项目 README（如需要）
    - 添加配色系统说明
    - 添加主题切换功能说明
    - _需求: 7.1_

- [x] 4. 更新底部导航栏
  - [x] 4.1 更新 BottomNav.tsx 配色
    - 更新导航栏背景色（浅色/深色模式）
    - 更新边框颜色
    - 更新激活状态颜色（使用 primary）
    - 更新未激活状态颜色（使用 secondary）
    - 添加过渡动画
    - _需求: 4.4, 6.3_
  - [x] 4.2 测试底部导航栏
    - 测试浅色模式显示
    - 测试深色模式显示
    - 测试激活状态切换
    - 验证对比度符合 WCAG AA 标准
    - _需求: 2.1, 2.2, 2.3, 3.5_

- [x] 5. 更新弹窗组件
  - [x] 5.1 更新 VisitNotificationModal.tsx 配色
    - 更新遮罩层颜色和透明度
    - 更新弹窗背景色（浅色/深色模式）
    - 更新标题文本颜色
    - 更新内容文本颜色
    - 更新边框和分隔线颜色
    - 更新按钮配色
    - _需求: 4.4, 6.3_
  - [x] 5.2 测试弹窗组件
    - 测试浅色模式显示
    - 测试深色模式显示
    - 测试遮罩层效果
    - 验证文本可读性
    - _需求: 2.1, 2.2, 3.5_

- [x] 6. 创建可复用按钮样式
  - [x] 6.1 定义按钮样式变体
    - 创建主要按钮样式（primary）
    - 创建次要按钮样式（secondary）
    - 创建危险按钮样式（error）
    - 创建信息按钮样式（info）
    - 为每个变体添加深色模式样式
    - 添加悬停、激活、禁用状态
    - _需求: 4.4, 5.4, 6.3_
  - [x] 6.2 创建按钮样式工具函数或组件
    - 在 components/ 下创建 Button.tsx（可选）
    - 或创建样式常量供其他组件使用
    - _需求: 5.4_

- [x] 7. 迁移首页（HomeScreen）
  - [x] 7.1 更新设备状态卡片
    - 更新卡片背景色和边框
    - 更新标题文本颜色
    - 更新设备在线状态指示器（success-500）
    - 更新设备离线状态指示器（error-500）
    - 更新连接中状态指示器（warning-500 + 脉动动画）
    - 添加深色模式样式
    - _需求: 4.1, 4.5, 8.3_
  - [x] 7.2 更新快捷操作按钮
    - 更新"开门"按钮（primary）
    - 更新"查看监控"按钮（secondary）
    - 更新"拒绝访问"按钮（error）
    - 添加悬停和激活状态
    - 添加深色模式样式
    - _需求: 4.1, 8.5_
  - [x] 7.3 更新最近动态列表
    - 更新成功开门记录样式（success 背景和边框）
    - 更新拒绝访问记录样式（error 背景和边框）
    - 更新时间戳文本颜色
    - 添加深色模式样式
    - _需求: 4.1, 8.4_
  - [x] 7.4 测试首页
    - 测试浅色模式所有元素
    - 测试深色模式所有元素
    - 测试状态切换动画
    - 验证对比度和可读性
    - _需求: 2.1, 2.2, 3.5_

- [x] 8. 迁移监控页（MonitorScreen）
  - [x] 8.1 更新视频容器
    - 设置视频背景为 secondary-950（深色，不随主题变化）
    - 更新 FPS 指示器样式（半透明背景 + 模糊效果）
    - 更新连接状态指示器
    - 确保覆盖层文本清晰可读
    - _需求: 4.2, 8.1, 8.2_
  - [x] 8.2 更新对讲控制按钮
    - 更新"按住说话"按钮（info 色系）
    - 添加对讲中状态（脉动效果 + ring）
    - 添加悬停和激活状态
    - 添加深色模式样式
    - _需求: 4.2, 8.2_
  - [x] 8.3 更新监控页其他元素
    - 更新页面背景色
    - 更新控制面板背景色
    - 更新文本颜色
    - 添加深色模式样式
    - _需求: 4.2_
  - [x] 8.4 测试监控页
    - 测试浅色模式显示
    - 测试深色模式显示
    - 测试视频内容突出效果
    - 验证对讲按钮交互反馈
    - _需求: 2.1, 2.2, 3.5, 8.1_

- [x] 9. 迁移设置页（SettingsScreen）
  - [x] 9.1 更新功能分组卡片
    - 更新人脸管理卡片样式
    - 更新指纹管理卡片样式
    - 更新 NFC 卡片管理卡片样式
    - 更新密码管理卡片样式
    - 更新日志记录卡片样式
    - 统一卡片背景、边框、标题样式
    - 添加深色模式样式
    - _需求: 4.3_
  - [x] 9.2 更新列表项样式
    - 更新人脸列表项样式
    - 更新指纹列表项样式
    - 更新 NFC 卡片列表项样式
    - 更新密码列表项样式
    - 添加悬停效果
    - 更新删除按钮颜色（error）
    - 添加深色模式样式
    - _需求: 4.3_
  - [x] 9.3 更新表单输入样式
    - 更新文本输入框样式
    - 添加焦点状态（primary ring）
    - 添加错误状态（error border）
    - 添加禁用状态
    - 更新占位符文本颜色
    - 添加深色模式样式
    - _需求: 4.4, 5.4_
  - [x] 9.4 更新日志记录颜色
    - 更新 INFO 日志颜色（secondary）
    - 更新 WARN 日志颜色（warning）
    - 更新 ERROR 日志颜色（error）
    - 添加深色模式样式
    - _需求: 4.3_
  - [x] 9.5 测试设置页
    - 测试浅色模式所有功能模块
    - 测试深色模式所有功能模块
    - 测试表单交互状态
    - 验证视觉层次和可读性
    - _需求: 2.1, 2.2, 3.5_

- [x] 10. 功能测试
  - [x] 10.1 全面功能测试
    - 测试所有页面的交互功能
    - 测试主题切换功能
    - 测试主题偏好持久化
    - 测试不同屏幕尺寸下的显示
    - _需求: 3.3_
  - [x] 10.2 跨浏览器测试
    - 在 Chrome 中测试
    - 在 Firefox 中测试
    - 在 Safari 中测试（如可用）
    - 在 Edge 中测试
    - _需求: 3.3_
  - [x] 10.3 移动端测试
    - 在 Android 设备上测试
    - 测试触摸交互
    - 测试响应式布局
    - _需求: 3.3_

- [x] 11. 可访问性测试
  - [x] 11.1 对比度验证
    - 使用工具验证所有文本与背景的对比度
    - 确保正常文本对比度 ≥ 4.5:1
    - 确保大文本对比度 ≥ 3:1
    - 确保交互元素对比度 ≥ 3:1
    - 验证深色模式的对比度
    - _需求: 2.1, 2.2, 2.3, 2.4, 3.5_
  - [x] 11.2 键盘导航测试
    - 测试 Tab 键导航顺序
    - 测试焦点状态可见性
    - 测试 Enter/Space 键激活
    - _需求: 2.5_
  - [x] 11.3 屏幕阅读器测试（可选）
    - 测试语义化标签
    - 测试 ARIA 属性
    - 测试内容可读性
    - _需求: 2.5_

- [x] 12. 性能和优化
  - [x] 12.1 性能测试
    - 检查 CSS 文件大小
    - 测试页面加载速度
    - 确保无性能退化
    - _需求: 7.4_
  - [x] 12.2 代码优化
    - 移除未使用的旧颜色类名
    - 统一样式命名规范
    - 添加必要的代码注释
    - _需求: 7.2, 7.3_
  - [x] 12.3 构建优化
    - 确保 Tailwind PurgeCSS 正常工作
    - 优化生产构建大小
    - _需求: 7.4_

- [x] 13. 文档和交付
  - [x] 13.1 完善文档
    - 完成 docs/color-system.md
    - 添加迁移说明
    - 添加故障排除指南
    - _需求: 5.5, 7.1, 7.2_
  - [x] 13.2 创建迁移报告
    - 记录所有修改的文件
    - 记录遇到的问题和解决方案
    - 记录测试结果
    - _需求: 7.3, 7.4, 7.5_
  - [x] 13.3 代码审查
    - 自我审查所有修改
    - 确保代码质量
    - 确保符合项目规范
    - _需求: 7.5_

- [x] 14. 实现属性测试
  - [x] 14.1 配置属性测试环境
    - 安装 fast-check 库
    - 配置测试框架（Vitest）
    - 创建测试辅助函数
    - _需求: 属性 1, 2, 3, 4_
  - [x] 14.2 实现属性 1：配置文件完整性测试
    - 编写测试验证所有颜色定义存在
    - 验证每个颜色有 11 个色阶
    - 验证色值格式正确（十六进制）
    - 最小迭代次数：100 次
    - _需求: 属性 1, 1.1, 1.2, 1.3, 1.4_
  - [x] 14.3 实现属性 2：对比度合规性测试
    - 编写对比度计算函数
    - 生成所有文本色和背景色组合
    - 验证正常文本对比度 ≥ 4.5:1
    - 验证大文本对比度 ≥ 3:1
    - 验证浅色和深色模式
    - 最小迭代次数：100 次
    - _需求: 属性 2, 2.1, 2.2, 2.3, 3.5_
  - [x] 14.4 实现属性 3：深色模式饱和度降低测试
    - 编写 HSL 饱和度提取函数
    - 比较浅色和深色模式的饱和度
    - 验证深色模式饱和度更低
    - 最小迭代次数：100 次
    - _需求: 属性 3, 3.4_
  - [x] 14.5 实现属性 4：文档完整性测试
    - 验证设计文档包含所有必需章节
    - 验证每个功能模块有配色方案
    - 验证迁移文档完整
    - 验证示例代码存在
    - _需求: 属性 4, 1.5, 4.1, 4.2, 4.3, 4.4, 4.5, 5.4, 5.5, 7.1, 7.2, 7.3, 7.4, 7.5_
  - [x] 14.6 运行所有属性测试
    - 执行所有属性测试
    - 记录测试结果
    - 修复发现的问题
    - _需求: 属性 1, 2, 3, 4_

## 可选任务

- [ ] 15. 增强功能（可选）
  - [ ] 15.1 添加主题切换动画
    - 实现平滑的颜色过渡动画
    - 添加主题切换时的视觉反馈
  - [ ] 15.2 支持系统主题自动切换
    - 监听系统主题变化
    - 自动切换应用主题（如用户未设置偏好）
  - [ ] 15.3 创建配色预览页面
    - 创建展示所有颜色的页面
    - 方便开发者查看和选择颜色
  - [ ] 15.4 添加对比度检查工具
    - 创建开发工具检查对比度
    - 在开发环境中显示警告

## 注意事项

### 实施顺序

任务应按照以下依赖关系顺序执行：

1. **任务 1-3**：配置和基础设施 - 必须首先完成
2. **任务 4-6**：通用组件迁移 - 依赖任务 1-3
3. **任务 7-9**：页面组件迁移 - 依赖任务 1-6
4. **任务 10-13**：测试和优化 - 依赖任务 1-9
5. **任务 14**：属性测试 - 可与任务 7-13 并行进行

### 关键检查点

- **检查点 1**（任务 1-2 完成后）：验证 Tailwind 配置和主题切换功能正常工作
- **检查点 2**（任务 4-6 完成后）：验证通用组件在两种主题下都正常显示
- **检查点 3**（任务 7-9 完成后）：验证所有页面迁移完成，无遗漏的旧颜色类名
- **检查点 4**（任务 10-13 完成后）：验证所有测试通过，文档完整

### 风险缓解

1. **对比度问题**：在实施过程中持续验证对比度，避免最后集中修复
2. **深色模式遗漏**：每完成一个组件立即测试深色模式，避免遗漏
3. **视觉一致性**：严格遵循设计文档的配色方案，保持一致性
4. **性能影响**：监控 CSS 文件大小，确保 PurgeCSS 正常工作
5. **用户体验**：提供主题切换功能，让用户选择偏好的模式

### 回滚方案

如果迁移过程中出现问题：

1. **快速回滚**：使用 `git checkout HEAD -- <file>` 恢复单个文件
2. **部分回滚**：保留配置，只恢复有问题的组件
3. **渐进式回滚**：在特性分支上进行迁移，主分支保持稳定

## 完成标准

所有任务完成后，应满足以下标准：

- [ ] 所有必需任务（非可选）已完成
- [ ] 所有页面和组件已迁移到新配色系统
- [ ] 浅色和深色模式都正常工作
- [ ] 所有对比度测试通过（WCAG AA 标准）
- [ ] 所有功能测试通过
- [ ] 所有属性测试通过
- [ ] 文档完整且准确
- [ ] 代码审查通过
- [ ] 无遗留的旧颜色类名
- [ ] 性能无明显退化
