---
name: doc-interview
description: 通过深度访谈完善技术文档、需求文档或设计文档。从一句话开始，通过系统性提问挖掘细节，识别边缘情况和风险点。触发词："帮我完善这个文档"、"深入访谈"、"细化需求"。
---

# 文档访谈技能

通过深度提问将草稿文档（甚至一句话）转化为完整的技术文档。

## 核心理念

**从最小化开始，通过提问扩展** - 你只需提供粗略想法，AI 通过系统性提问帮你构建完整文档。

## 何时使用

- ✅ 有粗略想法需要细化
- ✅ 不确定文档是否完整
- ✅ 需要识别边缘情况和风险
- ❌ 需求已经很清晰
- ❌ 简单的小改动
- ❌ 处理 Kiro spec 文件（用 spec 工作流）

## 工作流程

### 1. 静默分析

- 读取文档（如果有）
- 识别文档类型和完整度
- 制定访谈计划

### 2. 开场说明

```
我将通过 [X] 个问题帮你完善文档，涵盖：
- [关键领域 1]
- [关键领域 2]
- [关键领域 3]
```

### 3. 深度访谈

**提问原则：**

- 一次一个主题
- 从高层到细节
- 根据情况选择提问策略：
  - 需要交互式选项 → 逐个问
  - 问题独立且想节省时间 → 一次问多个
- 识别风险和权衡

**访谈维度（按优先级）：**

1. 核心目标和约束
2. 技术栈和架构
3. 数据模型和流程
4. 边缘情况和错误处理
5. 性能和扩展性
6. 安全性和合规性
7. 测试和验证
8. 运维和监控

**使用 userInput 工具：**

每次只能调用一个 `userInput`，有两种策略：

**策略 1：逐个提问（有交互式选项）**

```python
# 第一个问题
userInput(
    question="**Token 过期时间设置为多久？**",
    options=[
        {
            "title": "15 分钟",
            "description": "高安全性，需 Refresh Token"
        },
        {
            "title": "1 小时",
            "description": "平衡方案"
        },
        {
            "title": "24 小时",
            "description": "用户体验好，安全性低"
        }
    ],
    reason="general-question"
)

# 等待用户回答后，再问第二个问题
userInput(
    question="**是否需要 Refresh Token 机制？**",
    options=["需要", "不需要"],
    reason="general-question"
)
```

**策略 2：一次问多个（无交互式选项，但更快）**

```python
userInput(
    question="""**关于 JWT 认证，我需要了解几个细节：**

1. Token 过期时间设置为多久？
   - 15 分钟（高安全性，需 Refresh Token）
   - 1 小时（平衡）
   - 24 小时（用户体验好，安全性低）

2. 是否需要 Refresh Token 机制？

3. Token 存储在哪里？
   - localStorage（方便但有 XSS 风险）
   - HttpOnly Cookie（最安全，推荐）

请逐一回答这些问题。""",
    reason="general-question"
)
```

**选择建议：**

- 问题有依赖关系 → 用策略 1（逐个问）
- 问题独立且想节省时间 → 用策略 2（一次问多个）
- 需要交互式选项 → 用策略 1

### 4. 总结确认

```
关键决策：
1. [决策点 1]
2. [决策点 2]
3. [决策点 3]

还有其他需要补充的吗？
```

### 5. 文档更新

**推荐结构：**

```markdown
# [项目名称]

## 概述

目标、背景、核心价值

## 技术栈

语言、框架（含版本）、选择理由

## 架构设计

系统架构、模块划分、数据流

## 数据模型

数据库设计、关键实体

## 边界和约束

### ✅ 总是做

- [必须遵守的规则]

### ⚠️ 先询问

- [需要确认的操作]

### 🚫 绝不做

- [禁止的操作]

## 反目标（Anti-Goals）

明确不做什么

## 错误处理

异常处理策略、边界条件

## 性能和扩展性

性能目标、扩展策略

## 安全性

认证授权、数据保护

## 测试策略

单元测试、集成测试、验收标准

## 运维

部署、监控、日志

## 风险和权衡

已知风险、技术债务、权衡决策
```

## 最佳实践

### 1. 从一句话开始

```
用户：我想做一个任务管理工具
AI：好的！让我通过几个问题帮你细化...
```

### 2. 使用三层边界

- ✅ 总是做：必须遵守的规则
- ⚠️ 先询问：需要人工确认
- 🚫 绝不做：禁止的操作

### 3. 添加反目标

```markdown
## 反目标

- ❌ 不添加用户认证（使用现有 SSO）
- ❌ 不支持实时协作（v1.0 不需要）
```

### 4. 根据情况选择提问策略

**策略 1：逐个提问（推荐）**

- ✅ 有交互式选项，用户体验好
- ✅ 可以根据回答调整后续问题
- ❌ 需要多轮对话

**策略 2：一次问多个**

- ✅ 节省时间，一次性收集信息
- ❌ 没有交互式选项
- ❌ 用户需要手动输入所有答案

**选择建议：**

```
问题有依赖关系 → 策略 1
需要交互式选项 → 策略 1
问题独立且想快速收集 → 策略 2
```

### 5. 提供有意义的选项

```python
options=[
    {
        "title": "Redis",
        "description": "分布式缓存，支持多种数据结构"
    },
    {
        "title": "Memcached",
        "description": "简单高效，仅 key-value"
    }
]
```

### 6. 根据情况选择提问方式

**逐个提问（推荐）：**

```
用户：我选择 Redis

AI：**缓存什么类型的数据？**
选项：
- 用户信息
- 查询结果
- 会话数据
- 其他

[等待回答]

AI：**过期策略是什么？**
[继续下一个问题...]
```

**一次问多个（快速收集）：**

```
用户：我选择 Redis

AI：关于 Redis 缓存，我需要了解：
1. 缓存什么类型的数据？
2. 过期策略（TTL）？
3. 如何保证一致性？
4. 是否需要缓存预热？
5. 降级策略？

请逐一回答。
```

### 7. 识别风险

```
AI：你选择了微服务架构。需要注意：
⚠️ 风险：
- 分布式事务复杂
- 服务间通信开销
- 运维复杂度增加

你如何应对这些挑战？
```

## 访谈示例

### 从一句话开始

```
用户：我想做一个用户管理系统

AI：**这个系统的主要目标是什么？**
选项：
- 内部员工管理（HR）
- 客户账户管理（CRM）
- 多租户 SaaS 平台
- 其他

用户：多租户 SaaS 平台

AI：**关于多租户架构，你倾向于哪种隔离方式？**
选项：
- 共享数据库 + 租户 ID（成本低）
- 独立数据库（安全性高）
- 独立 Schema（折中）

用户：共享数据库 + 租户 ID

AI：**好的。这需要特别注意数据隔离：**
1. 如何防止跨租户数据泄露？
2. 是否需要租户级数据导出？（GDPR）
3. 预期租户数量？（影响索引设计）
```

### 完善现有文档

```
用户：帮我完善这个 API 设计文档 #docs/api.md

AI：我已阅读文档。需要细化：
- 认证机制
- 错误处理
- 性能目标

我将通过 8-10 个问题完善这些内容。

AI：**关于 API 认证，你计划使用哪种方案？**
选项：
- JWT（无状态，适合分布式）
- Session + Cookie（传统）
- OAuth 2.0（第三方授权）
- API Key（简单但安全性低）

用户：JWT

AI：**Token 过期时间设置为多久？**
选项：
- 15 分钟（高安全性，需 Refresh Token）
- 1 小时（平衡）
- 24 小时（用户体验好，安全性低）

[用户选择后]

AI：**是否需要 Refresh Token 机制？**
选项：需要 / 不需要

[用户选择后]

AI：**Token 存储在哪里？**
选项：
- localStorage（方便但有 XSS 风险）
- HttpOnly Cookie（最安全，推荐）
- sessionStorage（更安全但用户体验稍差）

[继续逐个提问...]
```

## 常见陷阱

| 不要                   | 应该                         |
| ---------------------- | ---------------------------- |
| 跨主题问多个不相关问题 | 同一主题下可以问多个相关问题 |
| 选项太模糊             | 提供清晰的优缺点             |
| 不追问细节             | 同一主题的追问可以一起问     |
| 忽略权衡和风险         | 主动指出挑战                 |
| 文档更新不完整         | 包含决策理由和风险           |

## 注意事项

- ❌ 不处理 `.kiro/specs/` 目录下的文件
- ❌ 不修改 `requirements.md`、`design.md`、`tasks.md`
- ✅ 如果是 spec 文档，建议使用 Kiro 的 spec 工作流
